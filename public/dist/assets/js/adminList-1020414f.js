var te=Object.defineProperty,le=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var U=(n,s,i)=>s in n?te(n,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[s]=i,P=(n,s)=>{for(var i in s||(s={}))ne.call(s,i)&&U(n,i,s[i]);if(R)for(var i of R(s))oe.call(s,i)&&U(n,i,s[i]);return n},M=(n,s)=>le(n,ae(s));import{d as Z,_ as re,o as p,c as v,a as k,a4 as B,r as L,$ as b,J as se,L as ie,M as de,f as d,a5 as me,j as u,h as o,l as e,a6 as ce,R as pe,g as h,a7 as _e,B as w,F as fe,k as ge,z as y,C as S,E as g}from"./index-ad449e55.js";import{e as Be}from"./edit-cc7581a8.js";const Fe=Z({name:"Lock"}),Ae={viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},he=k("path",{fill:"currentColor",d:"M224 448a32 32 0 0 0-32 32v384a32 32 0 0 0 32 32h576a32 32 0 0 0 32-32V480a32 32 0 0 0-32-32H224zm0-64h576a96 96 0 0 1 96 96v384a96 96 0 0 1-96 96H224a96 96 0 0 1-96-96V480a96 96 0 0 1 96-96z"},null,-1),Ce=k("path",{fill:"currentColor",d:"M512 544a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V576a32 32 0 0 1 32-32zm192-160v-64a192 192 0 1 0-384 0v64h384zM512 64a256 256 0 0 1 256 256v128H256V320A256 256 0 0 1 512 64z"},null,-1),De=[he,Ce];function Ee(n,s,i,a,V,_){return p(),v("svg",Ae,De)}var be=re(Fe,[["render",Ee]]);function we(n){return B({url:"managers",method:"get",params:n})}function ve(n){return B({url:"/managers/"+n,method:"get"})}function ke(n){return B({url:"/managers",method:"post",data:n})}function ye(n){return B({url:"/managers/delete",method:"post",data:n})}function T(n){return B({url:"/managers/update",method:"post",data:n})}function Ve(){return B({url:"/casbins/roles",method:"get"})}const xe={class:"app-container"},ze=y("\u65B0\u589E"),$e={class:"dialog-footer"},qe=y("\u786E \u5B9A"),Re=y("\u53D6 \u6D88"),Ue={name:"user"},Se=Z(M(P({},Ue),{setup(n){const s=L(b),i=L(b),a=se({loading:!0,ids:[],single:!0,multiple:!0,total:0,adminList:[],dialog:{visible:!1},formData:{status:0},queryParams:{page:1,pageSize:10},rules:{username:[{required:!0,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],nickname:[{required:!1,message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],password:[{required:!0,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"},{required:!0,pattern:/(?=.*[0-9])(?=.*[a-zA-Z]).{8,32}/,message:"\u5BC6\u7801\u5FC5\u987B\u5305\u542B\u6570\u7EC4\u548C\u5B57\u6BCD,\u957F\u5EA68-32\u4F4D\u4E4B\u95F4",trigger:"blur"}],email:[{required:!0,pattern:/\w[-\w.+]*@([A-Za-z0-9][-A-Za-z0-9]+\.)+[A-Za-z]{2,14}/,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740",trigger:"blur"}],status:[{required:!0,message:"\u72B6\u6001\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]},allRoles:[]}),{loading:V,queryParams:_,total:x,dialog:C,formData:m,rules:N}=ie(a);function H(r){S.confirm("\u786E\u8BA4\u8981\u5220\u9664\u7BA1\u7406\u5458"+r.username+"\u5417?","\u8B66\u544A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>ye({id:r.id}).then(()=>{g.success("\u5220\u9664\u6210\u529F")}).finally(()=>{F()}))}function F(){a.loading=!0,we(a.queryParams).then(({data:r})=>{a.adminList=r.items,a.total=r.count,a.loading=!1}),Ve().then(({data:r})=>{a.allRoles=r})}function I(r){a.ids=r.map(t=>t.id),a.single=r.length!==1,a.multiple=!r.length}function j(r){S.prompt("\u8BF7\u8F93\u5165\u7BA1\u7406\u5458\u300C"+r.username+"\u300D\u7684\u65B0\u5BC6\u7801","\u91CD\u7F6E\u5BC6\u7801",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88"}).then(({value:t})=>{if(!t)return g.warning("\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801"),!1;if(!t.match(/(?=.*[0-9])(?=.*[a-zA-Z]).{8,32}/))return g.warning("\u5BC6\u7801\u5FC5\u987B\u5305\u542B\u6570\u5B57\u548C\u5B57\u6BCD,\u957F\u5EA68-32"),!1;T({id:r.id,new_password:t}).then(()=>{g.success("\u4FEE\u6539\u6210\u529F\uFF0C\u65B0\u5BC6\u7801\u662F\uFF1A"+t)})}).catch(()=>{})}async function J(){a.dialog={title:"\u6DFB\u52A0\u7BA1\u7406\u5458",visible:!0}}async function Q(r){const t=r.id||a.ids;a.dialog={title:"\u4FEE\u6539\u7BA1\u7406\u5458\u4FE1\u606F",visible:!0},ve(t).then(({data:c})=>{a.formData=c})}function G(){i.value.validate(r=>{r&&(a.formData.id?T(a.formData).then(()=>{g.success("\u4FEE\u6539\u7528\u6237\u6210\u529F"),D(),F()}):ke(a.formData).then(()=>{g.success("\u65B0\u589E\u7528\u6237\u6210\u529F"),D(),F()}))})}function D(){a.dialog.visible=!1,a.formData.id=void 0,i.value.resetFields()}return de(()=>{F()}),(r,t)=>{const c=d("el-button"),f=d("el-form-item"),z=d("el-col"),$=d("el-row"),A=d("el-table-column"),K=d("el-table"),O=d("pagination"),W=d("el-card"),E=d("el-input"),X=d("el-option"),Y=d("el-select"),ee=d("el-dialog"),ue=me("loading");return p(),v("div",xe,[u($,{gutter:20},{default:o(()=>[u(z,{span:24,xs:24},{default:o(()=>[u(W,{class:"box-card"},{default:o(()=>[u(e(b),{ref_key:"queryFormRef",ref:s,model:e(_),inline:!0},{default:o(()=>[u($,null,{default:o(()=>[u(z,{span:18,xs:24},{default:o(()=>[u(f,null,{default:o(()=>[u(c,{type:"success",icon:e(ce),onClick:J},{default:o(()=>[ze]),_:1},8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),pe((p(),h(K,{data:e(a).adminList,onSelectionChange:I},{default:o(()=>[u(A,{key:"id",label:"\u7BA1\u7406\u5458\u7F16\u53F7",align:"center",prop:"id",width:"180"}),u(A,{key:"username",label:"\u7528\u6237\u540D",align:"center",prop:"username",width:"280"}),u(A,{key:"nickname",label:"\u6635\u79F0",align:"center",prop:"nickname",width:"280"}),u(A,{label:"\u90AE\u7BB1",align:"center",prop:"email",width:"320"}),u(A,{label:"\u64CD\u4F5C",align:"center"},{default:o(l=>[u(c,{type:"primary",icon:e(Be),circle:"",plain:"",onClick:q=>Q(l.row)},null,8,["icon","onClick"]),u(c,{type:"warning",icon:e(be),circle:"",plain:"",onClick:q=>j(l.row)},null,8,["icon","onClick"]),l.row.id!==1&&l.row.username!=="admin"?(p(),h(c,{key:0,type:"danger",icon:e(_e),circle:"",plain:"",onClick:q=>H(l.row)},null,8,["icon","onClick"])):w("",!0)]),_:1})]),_:1},8,["data"])),[[ue,e(V)]]),e(x)>0?(p(),h(O,{key:0,total:e(x),page:e(_).page,"onUpdate:page":t[0]||(t[0]=l=>e(_).page=l),limit:e(_).pageSize,"onUpdate:limit":t[1]||(t[1]=l=>e(_).pageSize=l),onPagination:F},null,8,["total","page","limit"])):w("",!0)]),_:1})]),_:1})]),_:1}),u(ee,{title:e(C).title,modelValue:e(C).visible,"onUpdate:modelValue":t[7]||(t[7]=l=>e(C).visible=l),width:"600px","append-to-body":"",onClose:D},{footer:o(()=>[k("div",$e,[u(c,{type:"primary",onClick:G},{default:o(()=>[qe]),_:1}),u(c,{onClick:D},{default:o(()=>[Re]),_:1})])]),default:o(()=>[u(e(b),{ref_key:"dataFormRef",ref:i,model:e(m),rules:e(N),"label-width":"80px"},{default:o(()=>[u(f,{label:"\u7528\u6237\u540D",prop:"username"},{default:o(()=>[u(E,{modelValue:e(m).username,"onUpdate:modelValue":t[2]||(t[2]=l=>e(m).username=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D"},null,8,["modelValue"])]),_:1}),e(C).title=="\u6DFB\u52A0\u7BA1\u7406\u5458"?(p(),h(f,{key:0,label:"\u7528\u6237\u5BC6\u7801",prop:"password"},{default:o(()=>[u(E,{modelValue:e(m).password,"onUpdate:modelValue":t[3]||(t[3]=l=>e(m).password=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u5BC6\u7801"},null,8,["modelValue"])]),_:1})):w("",!0),u(f,{label:"\u90AE\u7BB1",prop:"email"},{default:o(()=>[u(E,{modelValue:e(m).email,"onUpdate:modelValue":t[4]||(t[4]=l=>e(m).email=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u90AE\u7BB1"},null,8,["modelValue"])]),_:1}),u(f,{label:"\u6635\u79F0",prop:"nickname"},{default:o(()=>[u(E,{modelValue:e(m).nickname,"onUpdate:modelValue":t[5]||(t[5]=l=>e(m).nickname=l),placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u6635\u79F0"},null,8,["modelValue"])]),_:1}),u(f,{label:"\u89D2\u8272",prop:"roles"},{default:o(()=>[u(Y,{modelValue:e(m).roles,"onUpdate:modelValue":t[6]||(t[6]=l=>e(m).roles=l),multiple:"","collapse-tags":"",placeholder:"\u8BF7\u9009\u62E9\u7528\u6237\u89D2\u8272",style:{width:"240px"}},{default:o(()=>[(p(!0),v(fe,null,ge(e(a).allRoles,l=>(p(),h(X,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])}}}));export{Se as default};
